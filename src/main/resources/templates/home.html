<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UESW êµí†µì•ˆì „í˜ì´ì§€</title>
    <link rel="stylesheet" th:href="@{/css/home.css}">
	<link rel="stylesheet" th:href="@{/css/sidebar.css}">
	<script src="/js/home.js" defer></script>
	<script th:src="@{/js/session.js}" defer></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!--javascript í‚¤-->
	<script type="text/javascript" 
    src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=decabf1a98a2b15f0b977ba76ec9095c&autoload=false">
    </script>
    <!--REST API í‚¤-->
	<script type="text/javascript" 
    src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=393375d3d22851b3045f5e4712e02b0e&autoload=false">
    </script>
	<script th:replace="~{fragments/common :: headScript}"></script>
	
	<script th:fragment="headScript">
	    document.addEventListener("DOMContentLoaded", function() {
	        if (navigator.geolocation) {
	            navigator.geolocation.getCurrentPosition(function(position) {
	                const latitude = position.coords.latitude;
	                const longitude = position.coords.longitude;

	                // ìœ„ì¹˜ ì •ë³´ë¥¼ sessionStorageì— ì €ì¥
	                sessionStorage.setItem("latitude", latitude);
	                sessionStorage.setItem("longitude", longitude);

	                // ì¹´ì¹´ì˜¤ ë§µ ì´ˆê¸°í™” ë° ìœ„ì¹˜ í‘œì‹œ
	                kakao.maps.load(function() {
	                    const mapContainer = document.getElementById('home-map'); // ì§€ë„ í‘œì‹œí•  div
	                    const mapOption = {
	                        center: new kakao.maps.LatLng(latitude, longitude), // ì‚¬ìš©ìì˜ ìœ„ì¹˜
	                        level: 3 // ì¤Œ ë ˆë²¨
	                    };

	                    const map = new kakao.maps.Map(mapContainer, mapOption);

	                    // ì‚¬ìš©ì ìœ„ì¹˜ì— ë§ˆì»¤ í‘œì‹œ
	                    const markerPosition = new kakao.maps.LatLng(latitude, longitude);
	                    const marker = new kakao.maps.Marker({
	                        position: markerPosition
	                    });
	                    marker.setMap(map);
	                });
	            }, function(error) {
	                alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
	            });
	        } else {
	            alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
	        }
	    });
	    </script>
</head>

<body>
		<header>
<!--			<table class="main-header">
				<tr class="main-info">
					<td class="main-news">
						<iframe></iframe>
					</td>
					<td class="main-sns">
						<img src=""/>
						<img src=""/>
						<img src=""/>
					</td>
				</tr>
			</table>-->
			<!-- âœ… ëª¨ë‹¬ HTML -->
			<div id="notice-modal-container">
			  <div id="notice-modal-content">
			    <div id="notice-html-wrapper">
			      <h2>ğŸ“¢ ë„ë¡œ ëŒë°œìƒí™©</h2>
			      <div id="notice-content">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
			    </div>

			    <div class="button-wrapper">
			      <button id="modal-close-btn" onclick="document.getElementById('notice-modal-container').style.display='none'">ë‹«ê¸°</button>
			      <button id="modal-hide-btn" onclick="hideToday()">ì˜¤ëŠ˜ í•˜ë£¨ ì•ˆë³´ê¸°</button>
			    </div>
			  </div>
			</div>

			<script>
			  window.onload = function () {
			    const today = new Date().toISOString().split('T')[0]; // "2025-05-01" í˜•ì‹
			    const dismissedDate = localStorage.getItem('noticeDismissedDate');

			    if (dismissedDate === today) {
			      // ì´ë¯¸ ì˜¤ëŠ˜ì€ ì•ˆë³´ê¸° ì„ íƒí–ˆìœ¼ë©´ ëª¨ë‹¬ í‘œì‹œ ì•ˆ í•¨
			      return;
			    }

			    // ë¡œë”© í‘œì‹œ ì‹œì‘
			    document.getElementById('notice-content').innerText = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";

			    // /noticeì—ì„œ HTML ë¶ˆëŸ¬ì˜¤ê¸°
			    fetchWithTimeout('/notice', 5000)  // 5ì´ˆ í›„ íƒ€ì„ì•„ì›ƒ
			      .then(res => res.text())
			      .then(html => {
			        document.getElementById('notice-html-wrapper').innerHTML = html;
			        document.getElementById('notice-modal-container').style.display = 'flex';

			        // ë‹«ê¸° ë²„íŠ¼
			        document.getElementById('modal-close-btn').addEventListener('click', () => {
			          localStorage.setItem('noticeDismissedDate', today);
			          document.getElementById('notice-modal-container').style.display = 'none';
			        });

			        // ì˜¤ëŠ˜ í•˜ë£¨ ì•ˆë³´ê¸° ë²„íŠ¼
			        document.getElementById('modal-hide-btn').addEventListener('click', () => {
			          localStorage.setItem('noticeDismissedDate', today);
			          document.getElementById('notice-modal-container').style.display = 'none';
			        });
			      })
			      .catch(error => {
			        console.error('ê³µì§€ì‚¬í•­ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
			        document.getElementById('notice-content').innerText = "ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
			      });
			  };

			  // íƒ€ì„ì•„ì›ƒì„ ì„¤ì •í•œ fetch í•¨ìˆ˜
			  function fetchWithTimeout(url, timeout) {
			    return new Promise((resolve, reject) => {
			      const timeoutId = setTimeout(() => reject(new Error('ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.')), timeout);

			      fetch(url)
			        .then((response) => {
			          clearTimeout(timeoutId);
			          resolve(response);
			        })
			        .catch((error) => {
			          clearTimeout(timeoutId);
			          reject(error);
			        });
			    });
			  }

			  // ëª¨ë‹¬ì„ ì—´ë©´ì„œ API í˜¸ì¶œ
			  function openNoticeModal() {
			    document.getElementById("notice-content").innerText = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";

			    fetchWithTimeout('/api/notice', 5000)  // 5ì´ˆ í›„ íƒ€ì„ì•„ì›ƒ
			      .then(response => response.json())
			      .then(data => {
			        // ì˜ˆ: data = { message: "ì˜ë™ê³ ì†ë„ë¡œ ì°¨ëŸ‰ ì •ì²´ ë°œìƒ" }
			        document.getElementById("notice-content").innerText = data.message;
			      })
			      .catch(error => {
			        console.error("ê³µì§€ì‚¬í•­ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
			        document.getElementById("notice-content").innerText = "ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
			      });

			    // ëª¨ë‹¬ ì—´ê¸°
			    document.getElementById("notice-modal-container").style.display = "block";
			  }
			</script>
		</header>
		
		
		<!-- ë„·ë°” -->
		    <nav class="navbar">
		      <div class="container-fluid">
		          <!-- ë¸Œëœë“œ ì˜ì—­ -->
		          <a th:href="@{/home}" class="navbar-brand">
		              <img href="#" src="/img/Logo.png" alt="Logo" class="logo">
		          </a>

		          <!-- ë©”ë‰´ -->
		          <ul class="menu">
		              <li>
		                  <a>êµí†µìƒí™©</a>
		                  <ul class="submenu">
		                      <li><a th:href="@{/opendata}">êµí†µì •ë³´</a></li>
		                      <li><a th:href="@{/sidebar(section='traffic')}">ëŒë°œìƒí™©</a></li>
		                      <li><a th:href="@{/sidebar(section='weather')}">ê¸°ìƒì •ë³´</a></li>
		                  </ul>
		              </li>
		              <li>
		                  <a>êµí†µìë£Œ</a>
		                  <ul class="submenu">
		                      <li><a th:href="@{/carAccidentdata}">êµí†µì‚¬ê³ <br>ë°ì´í„°</a></li>
		                      <li><a th:href="@{/sidebar(section='cctv')}">CCTV</a></li>
		                  </ul>
		              </li>
		              <li><a th:href="@{/board}">ê²Œì‹œíŒ</a></li>
		              <li>
		                  <a>íšŒì›ì •ë³´</a>
		                  <ul class="submenu">
		                      <li><a th:href="@{/login}">ë¡œê·¸ì¸<br/>/íšŒì›ê°€ì…</a></li>
		                      <li><a th:href="@{/login_find}">íšŒì›ì •ë³´ ì°¾ê¸°</a></li>
							  <li><a th:href="@{/info}">ë§ˆì´í˜ì´ì§€</a></li>
						  </ul>
		              </li>
		          </ul>

		          <!-- ë¡œê·¸ì¸ ì•„ì´ì½˜ -->
		          <a th:href="@{/login}" class="login-button" >
		              <img id="login-img" src="/img/Login.png" alt="Login Icon" class="icon2">
		              <span id="login-txt" th:text="${session.loggedInUser != null ? 'Logout' : 'Login'}"></span>
		          </a>
		      </div>
		  </nav>
		  
		  <!-- ê³ ì • ì‚¬ì´ë“œë°” -->
		    <div class="sidebar">
		      
		      <!-- Font Awesome CDN ì¶”ê°€ -->
		      <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
		    <ul>
		      <li>
		        <button type="button" class="sidebar-button">
		          <a th:href="@{/sidebar(section='traffic')}">
		  			<i class="fa-solid fa-car"></i> <br>êµí†µ<br>ì†ë³´
		  		</a>
		        </button>
		      </li>
		      <li>
		        <button type="button" class="sidebar-button">
		  			<a th:href="@{/sidebar(section='weather')}">
		  				<i class="fa-solid fa-cloud-sun"></i> <br>ê¸°ìƒ<br>ì •ë³´
		  			</a>
		  		</button>
		      </li>
		      <li>
		        <button type="button" class="sidebar-button" >
		  		<a th:href="@{/sidebar(section='cctv')}">
		  			<i class="fa-solid fa-video"></i> <br>CCTV<br>ê²€ìƒ‰
		  		</a>
		        </button>
		      </li>
		      <li>
		        <button type="button" class="sidebar-button" >
					<a th:href="@{/info}">
		          	<i class="fa-solid fa-user"></i> <br>ë§ˆì´<br>í˜ì´ì§€
		        </button>
		      </li>
		      <li>
		        <button type="button" class="sidebar-button" >
		  		<a th:href="@{/sidebar(section='settings')}">
		  	        <i class="fa-solid fa-gear"></i> <br>ì„¤ì •
		  		</a>
		        </button>
		      </li>
		    </ul>
		<!-- ì‚¬ì´ë“œë°” ìŠ¤í¬ë¦½íŠ¸ -->
		<script src="/js/sidebar.js"></script>
	    </div>
		<div class="favorite-districts"></div>
		
		
		
	<div class="home-container">
		<div class="scrollBox">
			<div class="scroll_ani">
			    <p>Scroll Here !</p>
			</div>
		

	    <div class="home-content1" style="display: flex; align-items: center; justify-content: space-between;"> 
			<!--<button onclick="openNoticeModal()">ê³µì§€ ë³´ê¸°</button>-->
			<iframe src="monthly" width="70%" height="600px"style="border:none;"></iframe>
		</div>
		<div class="home-content2">
			<div class="map-button">
				<button onclick="setOverlayMapTypeId('traffic')">êµí†µì •ë³´ ë³´ê¸°</button> 
				<button onclick="setOverlayMapTypeId('roadview')">ë¡œë“œë·° ë„ë¡œì •ë³´ ë³´ê¸°</button> 
				<button onclick="setOverlayMapTypeId('terrain')">ì§€í˜•ì •ë³´ ë³´ê¸°</button>
				<button onclick="setOverlayMapTypeId('use_district')">ì§€ì í¸ì§‘ë„ ë³´ê¸°</button>
				<button onclick="setOverlayMapTypeId('roadmap')">ì¼ë°˜ì§€ë„ ë³´ê¸°</button>
			</div>
		    <!-- ì§€ë„ -->
			<div id="home-map" style="background-color: rgb(71, 62, 52);"> </div>
		</div>
		<div class="home-content3">
		</div>
		
		<div>
			<footer class="main-footbar">
			</footer>
		</div>
		
			<script>
				kakao.maps.load(function () {
				    var container = document.getElementById('home-map');
				    var options = {
				        center: new kakao.maps.LatLng(37.570715, 126.985324),
				        level: 3
				    };
				    window.map = new kakao.maps.Map(container, options);
					
					// ì§€ë„ í™•ëŒ€ ì¶•ì†Œë¥¼ ì œì–´í•  ìˆ˜ ìˆëŠ”  ì¤Œ ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
					var zoomControl = new kakao.maps.ZoomControl();
					map.addControl(zoomControl, kakao.maps.ControlPosition.BOTTOMLEFT);
					
				});
				// ì§€ë„ì— ì¶”ê°€ëœ ì§€ë„íƒ€ì…ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆì„ ë³€ìˆ˜ì…ë‹ˆë‹¤
				var currentTypeId;

				// ë²„íŠ¼ì´ í´ë¦­ë˜ë©´ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
				function setOverlayMapTypeId(maptype) {
				    var changeMaptype;
				    
				    // maptypeì— ë”°ë¼ ì§€ë„ì— ì¶”ê°€í•  ì§€ë„íƒ€ì…ì„ ê²°ì •í•©ë‹ˆë‹¤
				    if (maptype === 'traffic') {            
				        
				        // êµí†µì •ë³´ ì§€ë„íƒ€ì…
				        changeMaptype = kakao.maps.MapTypeId.TRAFFIC;     
				        
				    } else if (maptype === 'roadview') {        
				        
				        // ë¡œë“œë·° ë„ë¡œì •ë³´ ì§€ë„íƒ€ì…
				        changeMaptype = kakao.maps.MapTypeId.ROADVIEW;    

				    } else if (maptype === 'terrain') {
				        
				        // ì§€í˜•ì •ë³´ ì§€ë„íƒ€ì…
				        changeMaptype = kakao.maps.MapTypeId.TERRAIN;    

				    } else if (maptype === 'use_district') {
				        
				        // ì§€ì í¸ì§‘ë„ ì§€ë„íƒ€ì…
				        changeMaptype = kakao.maps.MapTypeId.USE_DISTRICT;           
				    } else if (maptype === 'roadmap') {
				        changeMaptype = kakao.maps.MapTypeId.ROADMAP; 
				    }
				    
				    // maptypeì— í•´ë‹¹í•˜ëŠ” ì§€ë„íƒ€ì…ì„ ì§€ë„ì— ì¶”ê°€í•©ë‹ˆë‹¤
				    map.addOverlayMapTypeId(changeMaptype);
				    
				    // ì§€ë„ì— ì¶”ê°€ëœ íƒ€ì…ì •ë³´ë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤
				    currentTypeId = changeMaptype;        
				}
			</script>
			
			<script>
				document.addEventListener('DOMContentLoaded', () => {
				    const scrollBox = document.querySelector('.scroll_ani');

				    if (scrollBox) {
				        // ë‚´ë¶€ ìŠ¤í¬ë¡¤ì„ í—ˆìš©í•˜ë„ë¡ ì„¤ì •
				        scrollBox.style.overflow = 'auto';

				        // íœ  ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ì²˜ë¦¬
				        scrollBox.addEventListener('wheel', (e) => {
				            // ê¸°ë³¸ íœ  ë™ì‘ì„ ë§‰ì§€ ì•ŠìŒ
				            const direction = e.deltaY > 0 ? 1 : -1;
				            console.log(`Scroll direction: ${direction}`);

				            // í˜ì´ì§€ ìŠ¤í¬ë¡¤
				            window.scrollBy({
				                top: direction * window.innerHeight,
				                behavior: 'smooth'
				            });
				        }, { passive: true }); // passive: trueë¡œ ì„¤ì •í•˜ì—¬ ê¸°ë³¸ ë™ì‘ì„ í—ˆìš©
				    } else {
				        console.warn('.scroll_ani ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
				    }
				});
			</script>
		</div>
	</div>
  </body>
</html>