<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ì˜¤ëŠ˜ì˜ ë‰´ìŠ¤</title>
</head>

<body>
	<div th:fragment="mainNews" style="width: 650px;">
		<!-- ë¡¤ë§ ë‰´ìŠ¤ ì˜ì—­ -->
		<div class="news-container">
			<div class="rolling-news-box">
				<ul id="rolling-news"></ul>
			</div>
				<section class="main-news-large" id="main-news-article">
					<p class="loading">ì£¼ìš” ë‰´ìŠ¤ ë¡œë“œ ì¤‘...</p>
				</section>

				<div class="small-news-list-container">
					<h2>ì´ ì‹œê° ì£¼ìš” ë‰´ìŠ¤</h2>
					<ul id="small-news-list">
						<p class="loading">ë‰´ìŠ¤ ëª©ë¡ ë¡œë“œ ì¤‘...</p>
					</ul>
				</div>
			</div>
			<script>
				fetch('/api/news.json')
					.then(response => response.json())
					.then(data => {
						const newsContainer = document.getElementById('rolling-news');
						data.forEach(news => {
							const li = document.createElement('li');
							const a = document.createElement('a');
							a.href = news.link;
							a.textContent = news.title;
							a.target = "_blank";
							li.appendChild(a);
							newsContainer.appendChild(li);
						});
					});
			</script>
			<script>
				let newsData = [];

				async function fetchNewsData() {
					try {
						const response = await fetch('/api/news.json');
						if (!response.ok) {
							throw new Error(`HTTP error! status: ${response.status}`);
						}
						newsData = await response.json();
						console.log('ë‰´ìŠ¤ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', newsData);

						if (newsData.length > 0) {
							renderMainLargeNews(newsData[0]); // ì²« ë²ˆì§¸ ê¸°ì‚¬ë¥¼ í¬ê²Œ í‘œì‹œ
							renderSmallNewsList(newsData.slice(1)); // ë‚˜ë¨¸ì§€ ê¸°ì‚¬ë“¤ì„ ëª©ë¡ìœ¼ë¡œ í‘œì‹œ
						} else {
							document.getElementById('main-news-article').innerHTML = '<p class="no-results">í‘œì‹œí•  ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
							document.getElementById('small-news-list').innerHTML = '<p class="no-results">í‘œì‹œí•  ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
						}

					} catch (error) {
						console.error('ë‰´ìŠ¤ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
						document.getElementById('main-news-article').innerHTML = '<p class="error-message">ë‰´ìŠ¤ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
						document.getElementById('small-news-list').innerHTML = '<p class="error-message">ë‰´ìŠ¤ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨.</p>';
					}
				}

				function renderMainLargeNews(newsItem) {
					const mainArticleDiv = document.getElementById('main-news-article');
					mainArticleDiv.innerHTML = ''; // ê¸°ì¡´ ë¡œë”© ë©”ì‹œì§€ ì œê±°

					if (!newsItem) {
						mainArticleDiv.innerHTML = '<p class="no-results">í‘œì‹œí•  ì£¼ìš” ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
						return;
					}

					const link = document.createElement('a');
					link.href = newsItem.link;
					link.target = '_blank';
					link.style.textDecoration = 'none';
					link.style.color = 'inherit';

					const thumbnailContainer = document.createElement('div');
					thumbnailContainer.className = 'thumbnail-container';
					const img = document.createElement('img');
					img.src = newsItem.thumbnail;
					img.alt = 'ë‰´ìŠ¤ ì¸ë„¤ì¼';
					img.onerror = function () {this.onerror = null; this.src = 'https://placehold.co/800x250/E0E0E0/555555?text=No+Image';};
					thumbnailContainer.appendChild(img);

					const textContent = document.createElement('div');
					textContent.className = 'text-content';

					const title = document.createElement('h2');
					title.textContent = newsItem.title;

					const description = document.createElement('p');
					description.textContent = newsItem.description || '';

					const readMoreLink = document.createElement('a');
					readMoreLink.href = newsItem.link;
					readMoreLink.target = '_blank';
					readMoreLink.textContent = 'ê¸°ì‚¬ ì›ë¬¸ ë³´ê¸°';
					readMoreLink.className = 'read-more';


					textContent.appendChild(title);
					textContent.appendChild(description);
					textContent.appendChild(readMoreLink);


					link.appendChild(thumbnailContainer);
					link.appendChild(textContent);

					mainArticleDiv.appendChild(link);
				}


				function renderSmallNewsList(newsItems) {
					const smallNewsListUl = document.getElementById('small-news-list');
					smallNewsListUl.innerHTML = ''; // ê¸°ì¡´ ë¡œë”© ë©”ì‹œì§€ ì œê±°

					if (newsItems.length === 0) {
						smallNewsListUl.innerHTML = '<p class="no-results">í‘œì‹œí•  ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
						return;
					}

					// ğŸ”¥ ì—¬ê¸°ì„œ ê°œìˆ˜ ì œí•œ: ìµœëŒ€ 8ê°œë§Œ í‘œì‹œ
					const limitedNewsItems = newsItems.slice(0, 8);

					limitedNewsItems.forEach(news => {
						const li = document.createElement('li');
						const a = document.createElement('a');
						a.href = news.link;
						a.target = "_blank";
						a.style.textDecoration = 'none'; /* ë°‘ì¤„ ì œê±° */
						a.style.color = 'inherit'; /* ìƒ‰ìƒ ìƒì† */

						// ì¸ë„¤ì¼ ì»¨í…Œì´ë„ˆ ìƒì„±
						const thumbnailDiv = document.createElement('div');
						thumbnailDiv.className = 'small-thumbnail';
						const img = document.createElement('img');
						img.src = news.thumbnail;
						img.alt = 'ë‰´ìŠ¤ ì¸ë„¤ì¼';
						img.onerror = function () {this.onerror = null; this.src = 'https://placehold.co/60x45/E0E0E0/555555?text=No+Image';}; // ì‘ì€ ëŒ€ì²´ ì´ë¯¸ì§€
						thumbnailDiv.appendChild(img);

						// ë‰´ìŠ¤ ì œëª© ì»¨í…Œì´ë„ˆ ìƒì„±
						const titleSpan = document.createElement('span');
						titleSpan.className = 'small-news-title';
						titleSpan.textContent = news.title;

						a.appendChild(thumbnailDiv); // ì¸ë„¤ì¼ ì¶”ê°€
						a.appendChild(titleSpan);    // ì œëª© ì¶”ê°€
						li.appendChild(a);
						smallNewsListUl.appendChild(li);
					});
				}

				fetchNewsData();

				const refreshInterval = 60 * 60 * 1000;
				setTimeout(() => {
					window.location.reload();
				}, refreshInterval);

				console.log(`í˜ì´ì§€ê°€ ${refreshInterval / 1000 / 60}ë¶„ í›„ì— ìƒˆë¡œê³ ì¹¨ë©ë‹ˆë‹¤.`);
			</script>
		</div>
</body>

</html>