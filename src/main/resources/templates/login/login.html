<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login_main</title>
  <link rel="stylesheet" href="/css/login.css"/>
</head>

<body>
  <div class="login-wrap">
    <div class="login-html">
      <!-- 탭 버튼 -->
      <input id="tab-1" type="radio" name="tab" class="sign-in" checked>
      <label for="tab-1" class="tab">로그인</label>
      <input id="tab-2" type="radio" name="tab" class="sign-up">
      <label for="tab-2" class="tab">회원가입</label>

      <div class="login-form">
        <!-- 로그인 폼 -->
        <div class="sign-in-htm">
          <form id="loginForm" th:action="@{/login}" method="post">
            <div class="group">
              <label for="account" class="label">아이디</label>
              <input id="account" type="text" class="input" required>
            </div>
            <div class="group">
              <label for="password" class="label">비밀번호</label>
              <input id="password" type="password" class="input" required>
            </div>
            <div class="group">
              <input id="check" type="checkbox" class="check" checked>
              <label for="check"><span class="icon"></span> 로그인 유지</label>
            </div>

            <!-- 메시지 출력 영역 -->
            <div id="error-message" style="color: red; font-size: 14px;"></div>
            <div id="message" style="color: lime; font-size: 14px;"></div>

            <button type="submit" class="button">로그인</button>
			<!-- 로그인 실패 시 alert 창 띄우기 -->
			<div th:if="${errorMessage}">
			    <script type="text/javascript">
					alert("${errorMessage}");
			    </script>
			</div>
          </form>

          <div class="hr"></div>
          <div class="foot-lnk">
            <a href="@{/login/Login_find_id.html}">아이디</a>
            <a>/</a>
            <a href="@{/login/Login_find_pw.html}">비밀번호</a>
            <a>찾기</a>
          </div>
        </div>

        <!-- 회원가입 폼 -->
        <div class="sign-up-htm">
          <form>
            <div class="group">
              <label for="account" class="label">아이디</label>
              <input id="account" type="text" class="input" required/>
            </div>
            <div class="group">
              <label for="password" class="label">비밀번호</label>
              <input id="password" type="password" class="input" required/>
            </div>
            <div class="group">
              <label for="userName" class="label">이름</label>
              <input id="userName" type="text" class="input" required/>
            </div>
            <div class="group">
              <label for="phoneNum" class="label">전화번호</label>
              <input id="phoneNum" type="tel" class="input" required/>
            </div>
            <div class="group">
              <label for="email" class="label">이메일</label>
              <input id="email" type="text" class="input" required/>
			  <span id="emailFeedback"></span>
            </div>
            <div class="group">
              <label for="birth" class="label">생년월일</label>
              <input id="birth" type="date" class="input" required/>
            </div>
            <div class="group">
              <label for="fullAddress" class="label">주소</label>
              <input id="fullAddress" type="text" class="input" required/>
            </div>
            <button type="submit" class="button">회원가입</button>
          </form>
		  
		  <script>
		    const registerForm = document.getElementById("registerForm");

		    registerForm.addEventListener("submit", function (event) {
		      event.preventDefault();

		      const data = {
		        account: document.getElementById("account").value,
		        password: document.getElementById("password").value,
		        userName: document.getElementById("userName").value,
		        phoneNum: document.getElementById("phoneNum").value,
		        email: document.getElementById("email").value,
		        birth: document.getElementById("birth").value,
		        fullAddress: document.getElementById("fullAddress").value,
		      };

		      fetch("/api/register", {
		        method: "POST",
		        headers: {
		          "Content-Type": "application/json",
		        },
		        body: JSON.stringify(data),
		      })
		      .then((response) => {
		        if (!response.ok) {
		          return response.text().then(text => { throw new Error(text); });
		        }
		        return response.text();
		      })
		      .then((result) => {
		        alert(result); // 성공 메시지
		      })
		      .catch((error) => {
		        alert("회원가입 실패: " + error.message);
		      });
		    });
		  </script>

          <div class="hr"></div>
          <div class="foot-lnk">
            <label for="tab-1">이미 회원이신가요?</label>
          </div>
        </div>
		
      </div>
    </div>
  </div>

  <!-- 로그인 실패 스크립트 -->
  <script>
    const loginForm = document.getElementById('loginForm');
    const errorMessage = document.getElementById('error-message');
    const message = document.getElementById('message');

    loginForm.addEventListener('submit', function(event) {
      event.preventDefault();

      const account = document.getElementById('account').value;
      const password = document.getElementById('password').value;

      // 로그인 API 호출
      fetch('/login', {
        method: 'POST',
        body: new URLSearchParams({
          account: account,
          password: password
        })
      })
      .then(response => {
        if (response.ok) {
          // 로그인 성공 시 메인 화면으로 리다이렉트
          window.location.href = "/main";
        } else {
          response.text().then(error => {
            errorMessage.textContent = error;
          });
        }
      })
      .catch(err => {
        errorMessage.textContent = "로그인 실패: " + err.message;
      });
    });
	
	<!--이메일 중복 체크-->
	const emailInput = document.getElementById("email");
	const feedback = document.getElementById("emailFeedback");

	emailInput.addEventListener("blur", () => {
	  const email = emailInput.value;

	  if (!email) return;

	  fetch(`/api/check-email?email=${encodeURIComponent(email)}`)
	    .then(response => response.json())
	    .then(isDuplicate => {
	      if (isDuplicate) {
	        feedback.textContent = "이미 사용 중인 이메일입니다.";
	        feedback.style.color = "red";
	      } else {
	        feedback.textContent = "사용 가능한 이메일입니다.";
	        feedback.style.color = "green";
	      }
	    })
	    .catch(err => {
	      feedback.textContent = "확인 중 오류가 발생했습니다.";
	      feedback.style.color = "orange";
	    });
	});
	
  </script>
</body>
</html>
